<div class="company-details-container">
  <!-- Loading State -->
  @if (isLoading()) {
  <div class="loading-state">
    <div class="spinner-modern"></div>
    <p class="loading-text">Loading company intelligence...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="error-state">
    <div class="error-icon">âš ï¸</div>
    <p class="error-text">{{ error() }}</p>
    <button (click)="goBack()" class="btn-primary">Go Back</button>
  </div>
  }

  <!-- Company Intelligence Hub -->
  @if (companyDetails() && !isLoading() && !error()) {
  <!-- Header Bar -->
  <div class="header-bar">
    <button (click)="goBack()" class="btn-back">
      <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Back to Companies
    </button>
    <div class="header-actions">
      <button (click)="editCompany()" class="btn-secondary">
        âœï¸ Edit
      </button>
      <button (click)="deleteCompany()" class="btn-danger">
        ğŸ—‘ï¸ Delete
      </button>
    </div>
  </div>

  <!-- Bento Grid Layout -->
  <div class="bento-grid">
    <!-- Column 1: Profile & Tech -->
    <div class="bento-column">
      <!-- Profile Card -->
      <div class="bento-card card-profile">
        <div class="profile-header">
          <!-- Logo -->
          <div class="company-logo-large">
            @if (getLogoUrl() && !logoFailed()) {
            <img [src]="getLogoUrl()" [alt]="companyDetails()!.name" (error)="onLogoError()" />
            } @else {
            <div class="logo-fallback-large">ğŸ¢</div>
            }
          </div>
          <div class="profile-info">
            <h1 class="company-name">{{ companyDetails()!.name }}</h1>
            @if (companyDetails()!.industry) {
            <span class="industry-badge">{{ companyDetails()!.industry }}</span>
            }
            @if (companyDetails()!.website) {
            <a [href]="companyDetails()!.website" target="_blank" rel="noopener noreferrer" class="website-link">
              ğŸŒ {{ companyDetails()!.website }}
            </a>
            }
          </div>
        </div>
      </div>

      <!-- Tech Stack Widget -->
      <div class="bento-card card-tech">
        <h2 class="card-title">ğŸ’» Tech Stack</h2>
        <div class="tech-tags">
          @if (companyDetails()!.techStack?.length) {
          @for (tech of companyDetails()!.techStack; track tech) {
          <span class="tech-tag">{{ tech }}</span>
          }
          } @else {
          <p class="empty-state-text">No tech stack info yet</p>
          }
        </div>
      </div>

      <!-- Stats Widget -->
      <div class="bento-card card-stats">
        <h2 class="card-title">ğŸ“Š Stats</h2>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value">{{ companyDetails()!.totalApplications }}</span>
            <span class="stat-label">Applications</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ getSuccessRate() }}%</span>
            <span class="stat-label">Success Rate</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Column 2: People & History (Wide) -->
    <div class="bento-column bento-column-wide">
      <!-- Contacts List -->
      <div class="bento-card card-contacts">
        <h2 class="card-title">ğŸ‘¥ Contacts</h2>
        <div class="contacts-list">
          @if (companyDetails()!.hrContactName || companyDetails()!.hrContactEmail) {
          <div class="contact-item">
            <div class="contact-avatar">{{ companyDetails()!.hrContactName?.charAt(0) || '?' }}</div>
            <div class="contact-info">
              <span class="contact-name">{{ companyDetails()!.hrContactName || 'HR Contact' }}</span>
              <span class="contact-role">Recruiter</span>
            </div>
            <div class="contact-actions">
              @if (companyDetails()!.hrContactEmail) {
              <a [href]="'mailto:' + companyDetails()!.hrContactEmail" class="contact-btn" title="Send Email">ğŸ“§</a>
              }
              @if (companyDetails()!.hrContactLinkedIn) {
              <a [href]="companyDetails()!.hrContactLinkedIn" target="_blank" rel="noopener noreferrer"
                class="contact-btn" title="LinkedIn">ğŸ”—</a>
              }
            </div>
          </div>
          } @else {
          <p class="empty-state-text">No contacts added yet</p>
          }
        </div>
      </div>

      <!-- Application Timeline -->
      <div class="bento-card card-timeline">
        <h2 class="card-title">ğŸ“‹ Application Timeline</h2>
        @if (companyDetails()!.applicationHistory.length === 0) {
        <p class="empty-state-text">No applications for this company yet</p>
        } @else {
        <div class="timeline-list">
          @for (app of companyDetails()!.applicationHistory; track app.id) {
          <button type="button" class="timeline-item" (click)="viewApplication(app.id)">
            <div class="timeline-dot" [class]="getStatusClass(app.status)"></div>
            <div class="timeline-content">
              <span class="timeline-position">{{ app.position }}</span>
              <span class="timeline-date">{{ formatDate(app.appliedAt) }}</span>
            </div>
            <span [class]="'timeline-status ' + getStatusClass(app.status)">{{ app.status }}</span>
          </button>
          }
        </div>
        }
      </div>
    </div>

    <!-- Column 3: Intelligence -->
    <div class="bento-column">
      <!-- Recent News -->
      <div class="bento-card card-news">
        <h2 class="card-title">ğŸ“° Recent News</h2>
        @if (newsLoading()) {
        <div class="news-loading">Loading news...</div>
        } @else if (companyNews().length === 0) {
        <p class="empty-state-text">No recent news found</p>
        } @else {
        <div class="news-list">
          @for (news of companyNews(); track news.id) {
          <div class="news-item">
            <span class="news-title">{{ news.title }}</span>
            <div class="news-meta">
              <span class="news-source">{{ news.source }}</span>
              <span class="news-date">{{ formatDate(news.date) }}</span>
            </div>
          </div>
          }
        </div>
        }
      </div>

      <!-- My Notes Scratchpad -->
      <div class="bento-card card-notes">
        <h2 class="card-title">ğŸ“ My Notes</h2>
        <textarea class="notes-textarea" placeholder="Jot down thoughts about this company..." [value]="companyNotes()"
          (input)="updateNotes($any($event.target).value)"></textarea>
      </div>
    </div>
  </div>
  }
</div>