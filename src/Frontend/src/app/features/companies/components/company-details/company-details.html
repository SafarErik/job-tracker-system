<div class="min-h-screen bg-background text-foreground pb-12 font-sans selection:bg-primary/20 overflow-x-hidden">
  <!-- Loading State -->
  @if (isLoading()) {
  <div class="flex flex-col items-center justify-center min-h-[60vh] gap-4 text-muted-foreground">
    <ng-icon name="lucideLoader2" class="text-4xl animate-spin text-primary"></ng-icon>
    <p class="text-sm font-medium tracking-wide">Retrieving Intelligence Dossier...</p>
  </div>
  }

  <!-- Error State -->
  @if (error()) {
  <div class="flex flex-col items-center justify-center min-h-screen gap-6 p-8 text-center">
    <div class="w-20 h-20 rounded-3xl bg-destructive/10 flex items-center justify-center">
      <ng-icon name="lucideBuilding2" class="text-4xl text-destructive"></ng-icon>
    </div>
    <div class="space-y-2">
      <h2 class="text-2xl font-black tracking-tight">Access Denied</h2>
      <p class="text-muted-foreground max-w-sm mx-auto">{{ error() }}</p>
    </div>
    <button hlmBtn variant="outline" (click)="goBack()" class="rounded-2xl">
      <ng-icon name="lucideArrowLeft" class="mr-2"></ng-icon>
      Return to Dashboard
    </button>
  </div>
  }

  <!-- Main Content -->
  @if (!isLoading() && !error() && company(); as details) {
  <div class="max-w-[1400px] mx-auto px-4 md:px-6 lg:px-8 pt-8 space-y-10">

    <!-- Header -->
    <app-company-header [company]="details" [logoUrl]="logoUrl()" (goBack)="goBack()"
      (updateName)="handleUpdateName($event)" (updatePriority)="handleUpdatePriority($event)"
      (updateIndustry)="handleUpdateIndustry($event)" (deleteCompany)="handleDeleteCompany()"></app-company-header>

    <!-- Bento Grid Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 pb-20">

      <!-- Column 1: Stats & Stack (Span 3) -->
      <div class="lg:col-span-3 space-y-6">
        <app-company-stats [totalApplications]="details.totalApplications" [successRate]="successRate()"
          [techStack]="details.techStack || []" (techAdd)="handleAddTech($event)"
          (techRemove)="handleRemoveTech($event)"></app-company-stats>
      </div>

      <!-- Column 2: Notes & Contacts (Span 6) -->
      <div class="lg:col-span-6 space-y-6">
        <app-company-notes [notes]="companyNotes()" (notesChange)="handleNotesChange($event)"></app-company-notes>

        <app-contact-list [contacts]="details.contacts || []" (save)="handleSaveContact($event)"
          (deleteContact)="handleDeleteContact($event)"></app-contact-list>
      </div>

      <!-- Column 3: Intel (News & History) (Span 3) -->
      <div class="lg:col-span-3 space-y-6">
        <app-company-intel [news]="companyNews()" [loading]="newsLoading()" [history]="details.applicationHistory"
          (viewApplication)="viewApplication($event)"></app-company-intel>
      </div>

    </div>
  </div>
  }
</div>