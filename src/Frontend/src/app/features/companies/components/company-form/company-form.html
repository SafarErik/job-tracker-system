<div class="container mx-auto px-4 py-8">
  <!-- Loading State -->
  @if (isLoading()) {
    <div class="flex flex-col items-center justify-center py-12 text-muted-foreground">
      <svg class="h-8 w-8 animate-spin text-primary mb-4" viewBox="0 0 24 24">
        <circle
          class="opacity-25"
          cx="12"
          cy="12"
          r="10"
          stroke="currentColor"
          stroke-width="4"
          fill="none"
        ></circle>
        <path
          class="opacity-75"
          fill="currentColor"
          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
        ></path>
      </svg>
      <p>Loading company data...</p>
    </div>
  }

  <!-- Form -->
  @if (!isLoading()) {
    <section hlmCard class="max-w-2xl mx-auto flex flex-col max-h-[90vh]">
      <!-- Header -->
      <div hlmCardHeader class="flex-shrink-0">
        <div class="flex items-start gap-4">
          <svg
            class="h-8 w-8 text-primary flex-shrink-0"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"
            />
          </svg>
          <div>
            <h1 hlmCardTitle class="text-2xl">
              {{ isEditMode() ? 'Edit Company' : 'Add New Company' }}
            </h1>
            <p hlmCardDescription>
              {{
                isEditMode()
                  ? 'Update company information'
                  : 'Create a new company in your database'
              }}
            </p>
          </div>
        </div>
      </div>

      <!-- Error Alert -->
      @if (error()) {
        <div
          class="mx-6 mb-4 flex items-center gap-2 rounded-lg border border-destructive/50 bg-destructive/10 px-4 py-3 text-destructive"
        >
          <svg class="h-5 w-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span>{{ error() }}</span>
        </div>
      }

      <!-- Scrollable Form Content -->
      <form
        [formGroup]="companyForm"
        (ngSubmit)="onSubmit()"
        hlmCardContent
        class="flex-1 overflow-y-auto space-y-8"
      >
        <!-- Company Information Section -->
        <div class="space-y-4">
          <h2
            class="flex items-center gap-2 text-sm font-medium text-primary uppercase tracking-wider"
          >
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              />
            </svg>
            Company Information
          </h2>

          <!-- Company Name -->
          <div class="space-y-2">
            <label hlmLabel for="name">
              Company Name <span class="text-destructive">*</span>
            </label>
            <input
              hlmInput
              type="text"
              id="name"
              formControlName="name"
              class="w-full"
              [class.border-destructive]="name?.invalid && name?.touched"
              placeholder="e.g., Google, Microsoft, Apple"
            />
            @if (name?.invalid && name?.touched) {
              <p class="text-sm text-destructive">
                @if (name?.errors?.['required']) {
                  Company name is required
                }
                @if (name?.errors?.['minlength']) {
                  Company name must be at least 2 characters
                }
              </p>
            }
          </div>

          <!-- Website -->
          <div class="space-y-2">
            <label hlmLabel for="website">Website</label>
            <div class="relative">
              <svg
                class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"
                />
              </svg>
              <input
                hlmInput
                type="url"
                id="website"
                formControlName="website"
                class="w-full pl-10"
                placeholder="https://www.example.com"
              />
            </div>
          </div>

          <!-- Address -->
          <div class="space-y-2">
            <label hlmLabel for="address">Address</label>
            <div class="relative">
              <svg
                class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                />
              </svg>
              <input
                hlmInput
                type="text"
                id="address"
                formControlName="address"
                class="w-full pl-10"
                placeholder="1234 Main Street, City, Country"
              />
            </div>
          </div>

          <!-- Industry -->
          <div class="space-y-2">
            <label hlmLabel for="industry">Industry</label>
            <select
              id="industry"
              formControlName="industry"
              class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
            >
              <option value="">Select an industry...</option>
              @for (industry of industryOptions; track industry) {
                <option [value]="industry">{{ industry }}</option>
              }
            </select>
          </div>

          <!-- Tech Stack -->
          <div class="space-y-2">
            <label hlmLabel>Tech Stack</label>
            <div class="space-y-3">
              <div class="flex flex-wrap gap-2">
                @for (tech of techStack(); track tech; let i = $index) {
                  <span hlmBadge variant="secondary" class="gap-1">
                    {{ tech }}
                    <button
                      type="button"
                      (click)="removeTech(i)"
                      class="ml-1 hover:text-destructive"
                    >
                      Ã—
                    </button>
                  </span>
                }
              </div>
              <div class="flex gap-2">
                <input
                  hlmInput
                  type="text"
                  placeholder="Type a technology and press Enter..."
                  [value]="newTech()"
                  class="flex-1"
                  (input)="newTech.set($any($event.target).value)"
                  (keydown)="onTechKeydown($event)"
                />
                <button hlmBtn variant="secondary" type="button" (click)="addTech()">Add</button>
              </div>
            </div>
          </div>
        </div>

        <!-- HR Contact Section -->
        <div class="space-y-4">
          <h2
            class="flex items-center gap-2 text-sm font-medium text-primary uppercase tracking-wider"
          >
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              />
            </svg>
            Contact Information
            <span hlmBadge variant="outline" class="text-xs">Optional</span>
          </h2>

          <!-- HR Contact Name -->
          <div class="space-y-2">
            <label hlmLabel for="hrContactName">HR Contact Name</label>
            <div class="relative">
              <svg
                class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                />
              </svg>
              <input
                hlmInput
                type="text"
                id="hrContactName"
                formControlName="hrContactName"
                class="w-full pl-10"
                placeholder="John Doe"
              />
            </div>
          </div>

          <!-- HR Contact Email -->
          <div class="space-y-2">
            <label hlmLabel for="hrContactEmail">HR Contact Email</label>
            <div class="relative">
              <svg
                class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                />
              </svg>
              <input
                hlmInput
                type="email"
                id="hrContactEmail"
                formControlName="hrContactEmail"
                class="w-full pl-10"
                [class.border-destructive]="hrContactEmail?.invalid && hrContactEmail?.touched"
                placeholder="hr@example.com"
              />
            </div>
            @if (hrContactEmail?.invalid && hrContactEmail?.touched) {
              <p class="text-sm text-destructive">Please enter a valid email address</p>
            }
          </div>

          <!-- HR LinkedIn -->
          <div class="space-y-2">
            <label hlmLabel for="hrContactLinkedIn">HR LinkedIn Profile</label>
            <div class="relative">
              <svg
                class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                />
              </svg>
              <input
                hlmInput
                type="url"
                id="hrContactLinkedIn"
                formControlName="hrContactLinkedIn"
                class="w-full pl-10"
                placeholder="https://www.linkedin.com/in/johndoe"
              />
            </div>
          </div>
        </div>
      </form>

      <!-- Sticky Footer -->
      <div hlmCardFooter class="flex justify-end gap-3 border-t bg-card/90 backdrop-blur">
        <button hlmBtn variant="ghost" type="button" (click)="goBack()">Cancel</button>

        <button
          hlmBtn
          type="submit"
          [disabled]="isSubmitting() || companyForm.invalid"
          (click)="onSubmit()"
          class="gap-2"
        >
          @if (isSubmitting()) {
            <svg class="h-4 w-4 animate-spin" viewBox="0 0 24 24">
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
                fill="none"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            <span>Saving...</span>
          } @else {
            <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5 13l4 4L19 7"
              />
            </svg>
            <span>{{ isEditMode() ? 'Update Company' : 'Create Company' }}</span>
          }
        </button>
      </div>
    </section>
  }
</div>
