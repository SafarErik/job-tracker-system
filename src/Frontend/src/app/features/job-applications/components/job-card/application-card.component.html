<!-- Smart Card - Pipeline Manager Design -->
<div hlmCard [class]="containerClasses()"
  class="group h-full transition-all duration-300 hover:border-primary/50 cursor-pointer overflow-hidden flex flex-col"
  (click)="onCardClick()">

  <!-- Header: Logo + Company Name + Status Badge -->
  <div class="p-4 flex items-center justify-between gap-4">
    <div class="flex items-center gap-3 min-w-0">
      <!-- Company Logo (Avatar) -->
      <div
        class="h-10 w-10 shrink-0 rounded-lg bg-secondary/50 border border-border/50 overflow-hidden flex items-center justify-center">
        @if (logoUrl() && !logoFailed()) {
        <img [src]="logoUrl()" [alt]="application().companyName" class="h-full w-full object-contain p-1"
          (error)="onLogoError()">
        } @else {
        <app-logo-placeholder [companyName]="application().companyName || '?'"></app-logo-placeholder>
        }
      </div>
      <!-- Company Name -->
      <h3 class="text-sm font-semibold text-muted-foreground truncate">
        {{ application().companyName || 'Unknown Company' }}
      </h3>
    </div>

    <!-- Status Badge -->
    <span [class]="getStatusClasses(application().status)">
      {{ statusLabel() }}
    </span>
  </div>

  <!-- Body: Job Title + Location + Match Score Tooltip -->
  <div class="px-4 pb-4 flex-1">
    <div class="flex items-start justify-between gap-2">
      <h2 class="text-lg font-bold text-foreground leading-tight line-clamp-2">
        {{ application().position }}
      </h2>

      <!-- Match Score Badge with Tooltip -->
      <hlm-tooltip hlmClassName="z-50 border-white/10 bg-slate-900/95 backdrop-blur-md text-white shadow-2xl">
        <button [class]="matchScoreColorClasses()"
          class="shrink-0 flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[10px] font-bold border transition-all duration-300"
          hlmTooltipTrigger>
          <ng-icon name="lucideSparkles" class="size-3"></ng-icon>
          {{ application().matchScore || 0 }}%
        </button>
        <span *brnTooltipContent>AI-estimated match based on keyword overlap between your CV and the Job
          Description.</span>
      </hlm-tooltip>
    </div>
    <div class="flex items-center gap-2 mt-2 text-xs text-muted-foreground">
      <span class="inline-flex items-center gap-1">
        <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
        {{ workplaceTypeLabel() }}
      </span>

      <!-- Salary Logic -->
      @if (application().salaryOffer) {
      <span
        class="inline-flex items-center px-2 py-0.5 rounded bg-emerald-500/10 text-emerald-500 text-[10px] font-bold border border-emerald-500/20">
        {{ application().salaryOffer | salaryFormatter:undefined:application().currency:application().salaryPeriod:true
        }}
      </span>
      } @else if (application().salaryMin) {
      <span class="text-[10px] text-muted-foreground italic">
        {{ application().salaryMin |
        salaryFormatter:application().salaryMax:application().currency:application().salaryPeriod }}
      </span>
      }
    </div>
  </div>

  <!-- Footer: AI Insight (Bottom Section) -->
  <div class="mt-auto bg-secondary/30 p-3 flex items-center justify-between gap-2 border-t border-border/10">
    <div class="flex flex-col">
      <span class="text-[10px] uppercase tracking-wider font-bold text-muted-foreground/70">AI Insight</span>
      <span class="text-xs font-semibold text-foreground">
        {{ application().matchScore >= 90 ? 'High Match: ' : 'Match Score: ' }}{{ application().matchScore || 0 }}%
      </span>
    </div>

    <div class="text-right">
      <span class="text-[10px] uppercase tracking-wider font-bold text-muted-foreground/70">Next Action</span>
      <div class="flex items-center justify-end gap-1.5 text-xs font-semibold" [class]="smartAction().color">
        <ng-icon [name]="smartAction().icon" class="size-3.5"></ng-icon>
        <span>{{ smartAction().text }}</span>
      </div>
    </div>
  </div>
</div>