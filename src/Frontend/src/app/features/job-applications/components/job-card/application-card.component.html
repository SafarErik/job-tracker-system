<!-- Smart Card - Pipeline Manager Design -->
<div hlmCard [class]="containerClasses()"
  class="group h-full transition-all duration-300 hover:border-primary/50 cursor-pointer flex flex-col shadow-sm"
  (click)="onCardClick()">

  <!-- Header: Logo + Company Name + Status Badge -->
  <div class="p-5 flex items-start justify-between gap-4">
    <div class="flex items-center gap-4 min-w-0">
      <!-- Company Logo (Avatar) -->
      <div
        class="size-12 shrink-0 rounded-xl bg-secondary/50 border border-border/50 overflow-hidden flex items-center justify-center shadow-inner group-hover:shadow-primary/20 transition-all duration-300">
        @if (logoUrl() && !logoFailed()) {
        <img [src]="logoUrl()" [alt]="application().companyName" class="h-full w-full object-contain p-1"
          (error)="onLogoError()">
        } @else {
        <app-logo-placeholder [companyName]="application().companyName || '?'" class="text-sm"></app-logo-placeholder>
        }
      </div>
      <!-- Company Name + Priority Icon -->
      <div class="flex flex-col min-w-0">
        <div class="flex items-center gap-2">
          <h3
            class="text-base font-bold text-foreground truncate leading-none group-hover:text-primary transition-colors">
            {{ application().companyName || 'Unknown Company' }}
          </h3>
          <!-- Priority Icon -->
          @if (application().priority === 2) {
          <ng-icon name="lucideFlame" class="size-3.5 text-orange-500 animate-pulse shrink-0"></ng-icon>
          } @else if (application().priority === 1) {
          <ng-icon name="lucideStar" class="size-3.5 text-amber-400 shrink-0"></ng-icon>
          }
        </div>
        <div class="text-xs text-muted-foreground mt-1 flex items-center gap-2.5">
          <!-- Workplace Type -->
          <span class="flex items-center gap-1">
            <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            {{ workplaceTypeLabel() }}
          </span>
          <span class="bg-border h-3 w-px"></span>
          <!-- Job Type -->
          <span class="flex items-center gap-1">
            <ng-icon name="lucideClock" class="size-3"></ng-icon>
            {{ jobTypeLabel() }}
          </span>
        </div>
      </div>
    </div>

    <!-- Right Side: Status + Match Score -->
    <div class="flex flex-col items-end gap-2">
      <span [class]="getStatusClasses(application().status)">
        {{ statusLabel() }}
      </span>

      <!-- Match Score Badge with Glowing Ring -->
      <hlm-tooltip hlmClassName="z-50 border-white/10 bg-slate-900/95 backdrop-blur-md text-white shadow-2xl">
        <button [class]="matchScoreColorClasses()"
          class="shrink-0 flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold border transition-all duration-300 hover:scale-105 hover:shadow-[0_0_10px_-2px_currentColor]"
          hlmTooltipTrigger>
          <ng-icon name="lucideSparkles" class="size-3.5"></ng-icon>
          {{ application().matchScore || 0 }}%
        </button>
        <span *brnTooltipContent>AI-estimated match based on keyword overlap between your CV and the Job
          Description.</span>
      </hlm-tooltip>
    </div>
  </div>

  <!-- Body: Job Title + Skills + Metrics -->
  <div class="px-5 pb-5 flex-1 flex flex-col gap-4">
    <!-- Title -->
    <h2 class="text-xl font-bold text-foreground leading-tight line-clamp-2">
      {{ application().position }}
      @if (application().department) {
      <span class="text-muted-foreground font-medium ml-1 text-lg">({{ application().department }})</span>
      }
    </h2>

    <!-- Skills Tags (New) -->
    @if (application().skills && application().skills.length > 0) {
    <div class="flex flex-wrap gap-1.5">
      @for (skill of application().skills.slice(0, 3); track skill) {
      <span
        class="px-2 py-0.5 rounded-md text-[10px] font-medium bg-secondary/40 text-secondary-foreground border border-white/5 whitespace-nowrap">
        {{ skill }}
      </span>
      }
      @if (application().skills.length > 3) {
      <span class="px-1.5 py-0.5 text-[10px] text-muted-foreground font-medium">+{{ application().skills.length - 3
        }}</span>
      }
    </div>
    }

    <!-- Row 3: Location & Date -->
    <div class="flex items-center gap-4 text-xs text-muted-foreground/80 mt-auto pt-2">
      <div class="flex items-center gap-1.5">
        <ng-icon name="lucideMapPin" class="size-3"></ng-icon>
        <span>{{ application().location || 'Remote' }}</span>
      </div>
      <div class="flex items-center gap-1.5">
        <ng-icon name="lucideCalendar" class="size-3"></ng-icon>
        <span>{{ application().appliedAt | date:'MMM yyyy' }}</span>
      </div>

      <!-- Salary Logic (Right aligned in this row or separate?) -->
      <div class="ml-auto">
        @if (application().salaryOffer) {
        <span
          class="inline-flex items-center px-2 py-1 rounded-md bg-emerald-500/10 text-emerald-500 text-xs font-bold border border-emerald-500/20 shadow-[0_0_8px_-2px_rgba(16,185,129,0.2)]">
          {{ application().salaryOffer |
          salaryFormatter:undefined:application().currency:application().salaryPeriod:true
          }}
        </span>
        } @else if (application().salaryMin) {
        <span
          class="text-xs text-muted-foreground font-medium bg-secondary/50 px-2 py-1 rounded-md border border-border/50">
          {{ application().salaryMin |
          salaryFormatter:application().salaryMax:application().currency:application().salaryPeriod }}
        </span>
        }
      </div>
    </div>
  </div>

  <!-- Footer: AI Insight (Bottom Section) -->
  <div class="mt-auto bg-secondary/30 p-3 flex items-center justify-between gap-4 border-t border-border/10">
    <div class="flex flex-col min-w-0">
      <span class="text-[10px] uppercase tracking-wider font-extrabold text-muted-foreground/60">Insight</span>
      <span class="text-xs font-medium text-foreground truncate">
        {{ application().matchScore >= 90 ? 'High Match Profile' : 'Standard Profile' }}
      </span>
    </div>

    <div class="text-right shrink-0">
      <span class="text-[10px] uppercase tracking-wider font-extrabold text-muted-foreground/60">Action</span>
      <div
        class="flex items-center justify-end gap-1.5 text-xs font-bold transition-all duration-300 group-hover:scale-105"
        [class]="smartAction().color">
        <ng-icon [name]="smartAction().icon" class="size-3.5"></ng-icon>
        <span>{{ smartAction().text }}</span>
      </div>
    </div>
  </div>
</div>