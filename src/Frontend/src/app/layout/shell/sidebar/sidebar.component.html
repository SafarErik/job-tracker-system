<hlm-sidebar collapsible="icon" variant="sidebar"
  class="h-full border-r border-border bg-background transition-[width] duration-300 ease-in-out">
  <div hlmSidebarHeader
    class="h-16 flex items-center px-4 overflow-hidden whitespace-nowrap group-data-[collapsible=icon]:px-0 group-data-[collapsible=icon]:justify-center transition-all duration-300">
    <!-- 
      We use a wrapper to control the logo's text visibility based on sidebar state 
      Since we want the logo component to handle the transition, we might need to be clever.
      But for now, let's just use the logo and control its text wrapper via global class or input if we had it.
      
      Actually, let's just hide the text part via CSS when sidebar is collapsed.
      The LogoComponent structure: div > div(icon) + div(text).
      We can use :host-context or just straightforward CSS in global styles if needed, 
      but better: 
    -->
    <div class="flex items-center gap-2 group-data-[collapsible=icon]:justify-center w-full transition-all">
      <!-- 
          We use the logo component. 
          When sidebar is collapsed (group-data-[collapsible=icon]), we want to effectively simulate 'iconOnly=true'.
          We can do this by hiding the text part with CSS.
       -->
      <app-logo class="transition-all duration-300" [class.opacity-100]="true" [withGlow]="false">
      </app-logo>
    </div>

    <!-- 
      HACK: To make the logo text strictly disappear when collapsed without accessing internal implementation:
      We need global style or ViewEncapsulation.None targeting app-logo inside [data-collapsible=icon].
      OR we rely on the container overflow.
    -->
    <style>
      /* Scoped style for this component's template to enforce logo behavior in sidebar */
      :host ::ng-deep hlm-sidebar[data-collapsible='icon'] app-logo .flex-col,
      :host ::ng-deep hlm-sidebar[data-collapsible='icon'] app-logo .whitespace-nowrap {
        width: 0 !important;
        opacity: 0 !important;
        overflow: hidden !important;
        margin: 0 !important;
      }
    </style>
  </div>

  <div hlmSidebarContent>
    <div hlmSidebarGroup>
      <div hlmSidebarGroupLabel
        hlmClassName="text-sidebar-foreground/50 uppercase tracking-widest text-[10px] font-bold px-4 mb-2">
        Main Navigation
      </div>
      <div hlmSidebarGroupContent>
        <ul hlmSidebarMenu class="px-2 group-data-[collapsible=icon]:px-0">
          @for (item of navItems; track item.label) {
          <li hlmSidebarMenuItem>
            <a hlmSidebarMenuButton [routerLink]="item.link"
              routerLinkActive="bg-sidebar-accent text-sidebar-accent-foreground"
              [routerLinkActiveOptions]="{ exact: item.exact }"
              class="group rounded-lg mb-1 justify-start group-data-[collapsible=icon]:!justify-center group-data-[collapsible=icon]:w-11 group-data-[collapsible=icon]:h-11 group-data-[collapsible=icon]:px-0">
              <ng-icon hlm [name]="item.icon" hlmClassName="w-5 h-5 group-hover:text-primary transition-colors" />
              <span class="group-data-[collapsible=icon]:hidden">{{ item.label }}</span>
            </a>
          </li>
          }
        </ul>
      </div>
    </div>
  </div>

  <div hlmSidebarFooter class="p-4 group-data-[collapsible=icon]:p-2! border-t border-sidebar-border overflow-hidden">
    <div class="flex items-center gap-3 w-full group-data-[collapsible=icon]:justify-center">
      <button [hlmDropdownMenuTrigger]="userMenu" hlmBtn variant="ghost"
        class="relative flex items-center gap-3 p-2 h-auto w-full justify-start group-data-[collapsible=icon]:justify-center! group-data-[collapsible=icon]:gap-0 group-data-[collapsible=icon]:p-0 group-data-[collapsible=icon]:w-12 group-data-[collapsible=icon]:h-12 hover:bg-sidebar-accent rounded-xl border border-transparent hover:border-sidebar-border transition-all group">
        <ng-icon hlm name="lucideChevronUp"
          hlmClassName="hidden group-data-[collapsible=icon]:block absolute -top-2 text-sidebar-foreground/60" />
        <hlm-avatar
          hlmClassName="w-8 h-8 rounded-lg ring-2 ring-sidebar-border group-data-[collapsible=icon]:w-9 group-data-[collapsible=icon]:h-9">
          <span hlmAvatarFallback hlmClassName="bg-primary text-primary-foreground text-[10px]">JD</span>
        </hlm-avatar>
        <div class="flex-1 text-left group-data-[collapsible=icon]:hidden">
          <p class="text-sm font-semibold text-sidebar-foreground">John Doe</p>
          <p class="text-[10px] text-sidebar-foreground/50 font-medium tracking-wide">ELITE PLAN</p>
        </div>
        <ng-icon hlm name="lucideChevronUp"
          hlmClassName="w-4 h-4 text-sidebar-foreground/50 group-data-[collapsible=icon]:hidden group-hover:text-sidebar-foreground transition-colors" />
      </button>
    </div>
  </div>

  <button hlmSidebarRail></button>
</hlm-sidebar>

<ng-template #userMenu>
  <div hlmDropdownMenu
    class="w-64 bg-popover/95 backdrop-blur-xl border border-border p-2 rounded-2xl shadow-2xl dark:shadow-primary/5 animate-in fade-in zoom-in-95">
    <div hlmDropdownMenuLabel
      hlmClassName="px-2 py-1.5 text-xs font-bold text-muted-foreground uppercase tracking-widest">
      Account Settings
    </div>
    <div hlmDropdownMenuSeparator hlmClassName="bg-border/50"></div>

    <div hlmDropdownMenuGroup>
      <button hlmDropdownMenuItem routerLink="/profile" hlmClassName="rounded-lg">
        <ng-icon hlm name="lucideUser" hlmDropdownMenuIcon />
        <span>Profile</span>
        <span hlmDropdownMenuShortcut>⌘P</span>
      </button>
      <button hlmDropdownMenuItem (click)="uiService.openProfileSettings()" hlmClassName="rounded-lg">
        <ng-icon hlm name="lucideSettings" hlmDropdownMenuIcon />
        <span>Settings</span>
        <span hlmDropdownMenuShortcut>⌘S</span>
      </button>
    </div>

    <div hlmDropdownMenuSeparator hlmClassName="bg-border/50"></div>

    <button hlmDropdownMenuItem (click)="onLogout()"
      class="text-red-400 focus:text-red-400 focus:bg-red-500/10 rounded-lg">
      <ng-icon hlm name="lucideLogOut" hlmDropdownMenuIcon />
      <span>Log out</span>
    </button>
  </div>
</ng-template>